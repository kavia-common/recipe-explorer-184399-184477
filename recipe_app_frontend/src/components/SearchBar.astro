---
export interface Props {
  value?: string;
  placeholder?: string;
}
const { value = "", placeholder = "Search recipes, ingredients..." } = Astro.props as Props;
---
<div class="searchbar card" role="search">
  <div class="row">
    <svg width="18" height="18" viewBox="0 0 24 24" aria-hidden="true"><path fill="#6b7280" d="M21 20l-4.3-4.3a7.5 7.5 0 1 0-1 1L20 21zM4 10.5a6.5 6.5 0 1 1 13 0a6.5 6.5 0 0 1-13 0"/></svg>
    <input id="search-input" class="input" type="search" name="q" value={value} placeholder={placeholder} aria-label="Search recipes" />
    <button class="ghost" id="clear-btn" aria-label="Clear search" title="Clear">
      Clear
    </button>
  </div>
</div>
<style>
  .searchbar {
    padding: 8px 10px;
  }
  .row {
    display: flex; align-items: center; gap: 8px;
  }
  #clear-btn { display: none; }
</style>
<script>
  const input = document.getElementById('search-input') as HTMLInputElement | null;
  const clearBtn = document.getElementById('clear-btn') as HTMLButtonElement | null;
  const params = new URLSearchParams(window.location.search);
  function updateClear() {
    if (!clearBtn || !input) return;
    clearBtn.style.display = input.value ? 'inline-flex' : 'none';
  }
  input?.addEventListener('input', () => {
    updateClear();
  });
  clearBtn?.addEventListener('click', () => {
    if (!input) return;
    input.value = '';
    params.delete('q');
    window.location.search = params.toString();
  });
  // submit on Enter by updating URL param
  input?.addEventListener('keydown', (e: KeyboardEvent) => {
    if (e.key === 'Enter') {
      const v = (e.target as HTMLInputElement).value;
      if (v) params.set('q', v); else params.delete('q');
      window.location.search = params.toString();
    }
  });
  updateClear();
</script>
